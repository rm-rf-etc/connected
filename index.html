<!DOCTYPE html>
<html>
<head>
  <title>Cross Talk</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { width: 100%; }
    body { width: 70%; margin: auto; margin-top: 3rem; }
    .column { float: left; margin: 0 5% 1rem 5%; }
    .width-6 { width: 40%; }
    .width-12 { width: 90%; }
    form { width: 100%; }
    input { width: 100%; }

    textarea { width: 100%; height: 10rem; }
    #gets-rendered-here {
      font-family: monospace;
    }
    #gets-rendered-here div {
      border: 1px solid #ccc;
      display: table;
      width: auto;
      padding: 0.1rem 0.3rem 0.1rem 0.3rem;
    }
  </style>

  <script>
    // $.fn.serializeObject = function(){
    //   var o = {}
    //   var a = this.serializeArray()
    //   $.each(a, function() {
    //     if (o[this.name]) {
    //       if (!o[this.name].push) {
    //         o[this.name] = [o[this.name]]
    //       }
    //       o[this.name].push(this.value || '')
    //     } else {
    //       o[this.name] = this.value || ''
    //     }
    //   })
    //   return o
    // }
  </script>
</head>
<body>
  <div class="column width-6">
    <form id="form1">
      <input name='one'/>
      <input name='two'/>
      <input name='three'/>
      <input name='four'/>
    </form>
  </div>
  <div class="column width-6">
    <form id="form2">
      <input name='one'/>
      <input name='two'/>
      <input name='three'/>
      <input name='four'/>
    </form>
  </div>
  <div class="column width-12">
<textarea id="your-json-here">
[
  {"tag":"div", "inner":"I'm bound to update when I change."},
  {"tag":"div", "inner":"But it's not using bound data"},
  {"tag":"div", "inner":"just yet."}
]
</textarea>
  </div>
  <div id="gets-rendered-here" class="column width-12">
  </div>
  <script src="/node_modules/microevent/microevent.js"></script>
  <script src="/main.js"></script>
  <script>
  var bindable = new CrossTalk.Binding({
    one: 'Your'
  , two: 'input'
  , three: 'goes'
  , four: 'here.'
  })


  var json
  var input = document.querySelector('#your-json-here')
  var canvas = document.querySelector('#gets-rendered-here')
  var container = new CrossTalk.Binding({})
  var _output = ''
  input.addEventListener('input',updateView)

  function updateView(){
    var json = false, html = ''

    try {
      json = JSON.parse(input.value)
    } catch(e) {
      html = 'Invalid JSON.'
    }

    if (json) html = CrossTalk.render( container.recompute(json).bindable )

    if (_output !== html) canvas.innerHTML = _output = html
  }
  updateView()

  CrossTalk.addForm(document.querySelector('#form1'), bindable)
  CrossTalk.addForm(document.querySelector('#form2'), bindable)
  </script>
</body>
</html>
